{% extends 'base.html.twig' %}

{% block body %}

<script>
  // add-collection-widget.js
jQuery(document).ready(function () {
    jQuery('.add-another-collection-widget').click(function (e) {
        var list = jQuery(jQuery(this).attr('data-list-selector'));
        // Try to find the counter of the list or use the length of the list
        var counter = list.data('widget-counter') | list.children().length;

        // grab the prototype template
        var newWidget = list.attr('data-prototype');
        // replace the "__name__" used in the id and name of the prototype
        // with a number that's unique to your emails
        // end name attribute looks like name="contact[emails][2]"
        newWidget = newWidget.replace(/__name__/g, counter);
        // Increase the counter
        counter++;
        // And store it, the length cannot be used if deleting widgets is allowed
        list.data('widget-counter', counter);

        // create a new list element and add it to the list
        var newElem = jQuery(list.attr('data-widget-tags')).html(newWidget);
        newElem.appendTo(list);
    });
});
</script>

<section class="events-layout big-screen mobile-layout">
    <event class="card mb-3">
        <h2 class="card-header mobile-title bg-light">{{ event.titre }}</h2>
        <div class="card-subtitle bg-event-date">
        <div class="corners">
        <img class="corner-top-left" src="/images/resources/corner_top_left.png">
        <img class="corner-top-right" src="/images/resources/corner_bottom_left.png">
        </div>
            <ul class="event-date-layout">
            {% for date in event.dates %}
                <li><div class="date-text">{{ date.dateDebut | localizeddate('none', 'none', null, null, 'EEEE d MMMM Y') }}</div> de <div class="date-text">{{ date.dateDebut | date('H\\Hi') }}</div> à <div class="date-text">{{ date.dateFin | date('H\\Hi') }}</div></li>
            {% endfor %}
            </ul>
        <div class="corners">
        <img class="corner-bottom-left" src="/images/resources/corner_top_right.png">
        <img class="corner-bottom-right" src="/images/resources/corner_bottom_right.png">
        </div>
        </div>
        <div class="card-body">
            <div class="tarifs-galops-container bg-secondary">
                <table class="tarifs-layout">
                  <tr>
                    <td  class="bg-secondary">- de 12 ans:</td><td class="bg-light"> {{ event.tarifMoinsDe12 }}€ </td>
                  </tr>
                  <tr>
                    <td class="bg-secondary">+ de 12 ans:</td><td class="bg-light"> {{ event.plusDe12 }}€ </td>
                  </tr>
                  <tr>
                    <td class="bg-secondary">Propriétaire:</td><td class="bg-light"> {{ event.proprietaire }}€ </td>
                  </tr>  
                </table>
                <div class="galops-layout"><div class="bg-secondary galops-text">Galops:</div>
                  <div class="bg-light galops-inner">
                  {% for galop in event.galops %}
                    <div class="btn bg-warning galop-layout">{{galop.niveau}}</div>
                  {% endfor %}
                  </div>
                </div>
              </div>
            <img class="event-img-layout" src="/images/properties/{{ ((event.images | first).imageName) }}">
            </br>
            {{ event.texte }}
            </br>
        </div>
        <div class="card-footer">
            <div> Places restantes : {{ event.nbMaxParticipants - event.utilisateurs|length }}</div>
        {% if not app.user %}
            <div>Connecter vous pour vous inscrire a l'evenement ! </div>
        {% else %}
            </br>
            <div>Inscription</div>
            <!-- test si le galot de l'utilisateur est dans l'évènement -->

            {% set bonGalop = false %}

            {% for galop in event.galops %}
                {% if app.user.galop >= galop %}
                    {%set bonGalop = true %}
                {% endif %}
            {% endfor %}

            {% if bonGalop %}

                {% set inscrit = false %}

                {% for participe in app.user.participe %}
                    {% if participe.id == event.id %}
                        {% set inscrit = true %}
                    {% endif %}
                {% endfor %}
                {% if not inscrit %}
                    
                    {{ form_start(form) }}
                    {{ form_row(form.ChoixRepas) }}
                    {{ form_end(form) }}  

                {% else %}
                    <div>Vous êtes inscrit pour cet évènement.</div>
                {% endif %}

            {% else %}
                <div>Pour s'inscrire à ce stage, veuillez contacter votre enseignant.</div>
            {% endif %}

            </br>

            <div>Inscrit</div>
            {% for utilisateur in event.utilisateurs %}
                {{ utilisateur.prenom }}
                {{ utilisateur.nom}}
            {% endfor %}

            </br>

            <div>Inscription benevole</div>

                {{ form_start(formBenevole) }}
                {{ form_row(formBenevole.creneaux) }}
                {{ form_end(formBenevole) }}
                
            </br>

            {% for creneaux in event.creneauxBenevoles %}
                <div>Benevole pour le {{ creneaux.dateDebut |date ('d/m/Y') }} de {{ creneaux.dateDebut |date ('H:i') }} à {{ creneaux.dateFin |date ('H:i') }} </div>
                {% for utilisateur in creneaux.utilisateurs %}
                    {{ utilisateur.prenom }}
                    {{ utilisateur.nom}}
                    </br>
                {% endfor %}
                </br>
            {% endfor %}

        {% endif %}
        </div>
    </event>
    
</section>

    {% if app.user %}
        {% if app.user.roles[0] == 'ROLE_ADMIN_ASSO' %}
        <HR width="50%" size="10" noshade />
        <section class="events-layout big-screen mobile-layout asso-layout">
            <div class="card mb-3 card-body">
            {{ form_start(formAsso) }}
            
            <ul id="creneaux-fields-list"
                    data-prototype="{{ form_widget(formAsso.creneauxBenevoles.vars.prototype)|e }}"
                    data-widget-tags="{{ '<li></li>'|e }}"
                    data-widget-counter="{{ formAsso.children|length }}">
                {% for NbBenevole in formAsso.creneauxBenevoles %}
                    <li>
                        {{ form_errors(NbBenevole) }}
                        {{ form_widget(NbBenevole) }}
                    </li>
                {% endfor %}
            </ul>
            
            <button type="button"
            class="add-another-collection-widget"
            data-list-selector="#creneaux-fields-list">Add another date</button>

            <button type="submit" class="btn btn-success">Enregistrer</button>

            {{ form_row(formAsso.creneauxBenevoles,{ 'label' : false } ) }}

            {{ form_end(formAsso) }}
            </div>
        </section>
        {% endif %}
    {% endif %}

{% endblock %}