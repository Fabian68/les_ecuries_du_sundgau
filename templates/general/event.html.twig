{% extends 'base.html.twig' %}

{% block body %}

<section class="events-layout big-screen mobile-layout">
    <event class="card mb-3">
        <h2 class="card-header mobile-title bg-light">{{ event.titre }}</h2>
        <div class="card-subtitle bg-event-date">
        <div class="corners">
        <img class="corner-top-left" src="/images/resources/corner_top_left.png">
        <img class="corner-top-right" src="/images/resources/corner_bottom_left.png">
        </div>
            <ul class="event-date-layout">
            {% for date in event.dates %}
                <li><div class="date-text">{{ date.dateDebut | localizeddate('none', 'none', null, null, 'EEEE d MMMM Y') }}</div> de <div class="date-text">{{ date.dateDebut | date('H\\Hi') }}</div> à <div class="date-text">{{ date.dateFin | date('H\\Hi') }}</div></li>
            {% endfor %}
            </ul>
        <div class="corners">
        <img class="corner-bottom-left" src="/images/resources/corner_top_right.png">
        <img class="corner-bottom-right" src="/images/resources/corner_bottom_right.png">
        </div>
        </div>
        <div class="card-body">
            <div class="tarifs-galops-container bg-secondary">
                <table class="tarifs-layout">
                  <tr>
                    <td  class="bg-secondary">- de 12 ans:</td><td class="bg-light"> {{ event.tarifMoinsDe12 }}€ </td>
                  </tr>
                  <tr>
                    <td class="bg-secondary">+ de 12 ans:</td><td class="bg-light"> {{ event.plusDe12 }}€ </td>
                  </tr>
                  <tr>
                    <td class="bg-secondary">Propriétaire:</td><td class="bg-light"> {{ event.proprietaire }}€ </td>
                  </tr>  
                </table>
                <div class="galops-layout"><div class="bg-secondary galops-text">Galops:</div>
                  <div class="bg-light galops-inner">
                  {% for galop in event.galops %}
                    <div class="btn bg-warning galop-layout">{{galop.niveau}}</div>
                  {% endfor %}
                  </div>
                </div>
              </div>
            <img class="event-img-layout" src="/images/properties/{{ ((event.images | first).imageName) }}">
            </br>
            {{ event.texte }}
            </br>
        </div>
        <div class="card-footer">
            <div> Places restantes : {{ event.nbMaxParticipants - event.utilisateurs|length }}</div>
        {% if not app.user %}
            <div>Connecter vous pour vous inscrire a l'evenement ! </div>
        {% else %}
            </br>
            <div>Inscription</div>
            <!-- test si le galot de l'utilisateur est dans l'évènement -->

            {% set inscrit = false %}

            {% for participe in app.user.participe %}
                {% if participe.id == event.id %}
                    {% set inscrit = true %}
                {% endif %}
            {% endfor %}
            {% if not inscrit %}
                <p>
                <label for="PrendreRepas">Repas</label>
                <input type="checkbox" name="ChoixRepas" id="PrendreRepas">
                </p>
                {{ form_start(form) }}
                {{ form_end(form) }}                
            {% else %}
                <div>Vous êtes inscrit pour cet évènement.</div>
            {% endif %}

            {% for utilisateur in event.utilisateurs %}
                {{ utilisateur.prenom }}
                {{ utilisateur.nom}}
            {% endfor %}

            </br>
            <div>Inscription benevole</div>

            {{ form_start(formBenevole) }}
            {{ form_end(formBenevole) }} 

        {% endif %}
        </div>
    </event>
    
</section>

    {% if app.user %}
        {% for role in app.user.roles %}
            {% if role == 'ROLE_ADMIN_ASSO' %}
            <HR width="50%" size="10" noshade />
            <section class="events-layout big-screen mobile-layout asso-layout">
              <div class="card mb-3 card-body">
                {{ form_start(formAsso) }}
                
                <ul id="creneaux-fields-list"
                        data-prototype="{{ form_widget(formAsso.creneauxBenevoles.vars.prototype)|e }}"
                        data-widget-tags="{{ '<li></li>'|e }}"
                        data-widget-counter="{{ formAsso.children|length }}">
                    {% for NbBenevole in formAsso.creneauxBenevoles %}
                        <li>
                            {{ form_errors(NbBenevole) }}
                            {{ form_widget(NbBenevole) }}
                        </li>
                    {% endfor %}
                </ul>

                {{ form_row(formAsso.creneauxBenevoles) }}
                
                <button type="button"
                class="add-another-collection-widget"
                data-list-selector="#creneaux-fields-list">Add another date</button>

                <button type="submit" class="btn btn-success">Enregistrer</button>

                {{ form_end(formAsso) }}
              </div>
            </section>
            {% endif %}
        {% endfor %}
    {% endif %}

{% endblock %}